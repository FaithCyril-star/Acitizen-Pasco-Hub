{"id":"XBbW","dependencies":[{"name":"C:\\Users\\ACC\\Desktop\\APH\\Acitizen-Pasco-Hub\\backend\\node_modules\\@azure\\storage-blob\\dist-esm\\storage-blob\\src\\BatchResponseParser.js.map","includedInParent":true,"mtime":1672192592447},{"name":"C:\\Users\\ACC\\Desktop\\APH\\Acitizen-Pasco-Hub\\backend\\package.json","includedInParent":true,"mtime":1672218648515},{"name":"C:\\Users\\ACC\\Desktop\\APH\\Acitizen-Pasco-Hub\\backend\\node_modules\\@azure\\storage-blob\\package.json","includedInParent":true,"mtime":1672192591436},{"name":"@azure/core-http","loc":{"line":3,"column":28,"index":103},"parent":"C:\\Users\\ACC\\Desktop\\APH\\Acitizen-Pasco-Hub\\backend\\node_modules\\@azure\\storage-blob\\dist-esm\\storage-blob\\src\\BatchResponseParser.js","resolved":"C:\\Users\\ACC\\Desktop\\APH\\Acitizen-Pasco-Hub\\backend\\node_modules\\@azure\\core-http\\dist-esm\\src\\index.js"},{"name":"./utils/constants","loc":{"line":4,"column":88,"index":211},"parent":"C:\\Users\\ACC\\Desktop\\APH\\Acitizen-Pasco-Hub\\backend\\node_modules\\@azure\\storage-blob\\dist-esm\\storage-blob\\src\\BatchResponseParser.js","resolved":"C:\\Users\\ACC\\Desktop\\APH\\Acitizen-Pasco-Hub\\backend\\node_modules\\@azure\\storage-blob\\dist-esm\\storage-blob\\src\\utils\\constants.js"},{"name":"./BatchUtils","loc":{"line":5,"column":30,"index":262},"parent":"C:\\Users\\ACC\\Desktop\\APH\\Acitizen-Pasco-Hub\\backend\\node_modules\\@azure\\storage-blob\\dist-esm\\storage-blob\\src\\BatchResponseParser.js","resolved":"C:\\Users\\ACC\\Desktop\\APH\\Acitizen-Pasco-Hub\\backend\\node_modules\\@azure\\storage-blob\\dist-esm\\storage-blob\\src\\BatchUtils.browser.js"},{"name":"./log","loc":{"line":6,"column":23,"index":301},"parent":"C:\\Users\\ACC\\Desktop\\APH\\Acitizen-Pasco-Hub\\backend\\node_modules\\@azure\\storage-blob\\dist-esm\\storage-blob\\src\\BatchResponseParser.js","resolved":"C:\\Users\\ACC\\Desktop\\APH\\Acitizen-Pasco-Hub\\backend\\node_modules\\@azure\\storage-blob\\dist-esm\\storage-blob\\src\\log.js"}],"generated":{"js":"\"use strict\";Object.defineProperty(exports,\"__esModule\",{value:!0}),exports.BatchResponseParser=void 0;var s=require(\"@azure/core-http\"),e=require(\"./utils/constants\"),t=require(\"./BatchUtils\"),n=require(\"./log\");const o=\": \",r=\" \",i=-1;class a{constructor(s,t){if(!s||!s.contentType)throw new RangeError(\"batchResponse is malformed or doesn't contain valid content-type.\");if(!t||0===t.size)throw new RangeError(\"Invalid state: subRequests is not provided or size is 0.\");this.batchResponse=s,this.subRequests=t,this.responseBatchBoundary=this.batchResponse.contentType.split(\"=\")[1],this.perResponsePrefix=`--${this.responseBatchBoundary}${e.HTTP_LINE_ENDING}`,this.batchResponseEnding=`--${this.responseBatchBoundary}--`}async parseBatchResponse(){if(this.batchResponse._response.status!==e.HTTPURLConnection.HTTP_ACCEPTED)throw new Error(`Invalid state: batch request failed with status: '${this.batchResponse._response.status}'.`);const a=(await(0,t.getBodyAsText)(this.batchResponse)).split(this.batchResponseEnding)[0].split(this.perResponsePrefix).slice(1),p=a.length;if(p!==this.subRequests.size&&1!==p)throw new Error(\"Invalid state: sub responses' count is not equal to sub requests' count.\");const h=new Array(p);let u=0,c=0;for(let t=0;t<p;t++){const p=a[t],d={};d.headers=new s.HttpHeaders;const l=p.split(`${e.HTTP_LINE_ENDING}`);let R=!1,b=!1,T=!1,f=i;for(const s of l)if(R)if(\"\"!==s.trim())if(b)d.bodyAsText||(d.bodyAsText=\"\"),d.bodyAsText+=s;else{if(-1===s.indexOf(o))throw new Error(`Invalid state: find non-empty line '${s}' without HTTP header delimiter '${o}'.`);const t=s.split(o);d.headers.set(t[0],t[1]),t[0]===e.HeaderConstants.X_MS_ERROR_CODE&&(d.errorCode=t[1],T=!0)}else b||(b=!0);else if(s.startsWith(e.HeaderConstants.CONTENT_ID)&&(f=parseInt(s.split(o)[1])),s.startsWith(e.HTTP_VERSION_1_1)){R=!0;const e=s.split(r);d.status=parseInt(e[1]),d.statusMessage=e.slice(2).join(r)}f!==i&&Number.isInteger(f)&&f>=0&&f<this.subRequests.size&&void 0===h[f]?(d._request=this.subRequests.get(f),h[f]=d):n.logger.error(`subResponses[${t}] is dropped as the Content-ID is not found or invalid, Content-ID: ${f}`),T?c++:u++}return{subResponses:h,subResponsesSucceededCount:u,subResponsesFailedCount:c}}}exports.BatchResponseParser=a;"},"sourceMaps":{"js":{"mappings":[{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":182,"column":1},"generated":{"line":1,"column":0}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":182,"column":1},"generated":{"line":1,"column":13}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":182,"column":1},"generated":{"line":1,"column":20}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":182,"column":1},"generated":{"line":1,"column":35}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":182,"column":1},"generated":{"line":1,"column":43}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":182,"column":1},"generated":{"line":1,"column":56}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":182,"column":1},"generated":{"line":1,"column":57}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":182,"column":1},"generated":{"line":1,"column":64}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":182,"column":1},"generated":{"line":1,"column":68}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":182,"column":1},"generated":{"line":1,"column":76}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":182,"column":1},"generated":{"line":1,"column":101}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":4,"column":0},"generated":{"line":1,"column":103}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":4,"column":0},"generated":{"line":1,"column":107}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":4,"column":0},"generated":{"line":1,"column":109}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":4,"column":0},"generated":{"line":1,"column":117}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":7,"column":0},"generated":{"line":1,"column":137}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":7,"column":0},"generated":{"line":1,"column":139}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":7,"column":0},"generated":{"line":1,"column":147}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":13,"column":0},"generated":{"line":1,"column":168}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":13,"column":0},"generated":{"line":1,"column":170}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":13,"column":0},"generated":{"line":1,"column":178}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":16,"column":0},"generated":{"line":1,"column":194}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":16,"column":0},"generated":{"line":1,"column":196}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":16,"column":0},"generated":{"line":1,"column":204}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":18,"column":0},"generated":{"line":1,"column":213}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":18,"column":6},"generated":{"line":1,"column":219}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":18,"column":30},"generated":{"line":1,"column":221}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":19,"column":6},"generated":{"line":1,"column":226}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":19,"column":24},"generated":{"line":1,"column":228}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":20,"column":6},"generated":{"line":1,"column":232}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":20,"column":19},"generated":{"line":1,"column":235}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":25,"column":6},"generated":{"line":1,"column":237}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":25,"column":13},"generated":{"line":1,"column":243}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":32,"column":2},"generated":{"line":1,"column":245}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":33,"column":4},"generated":{"line":1,"column":257}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":34,"column":4},"generated":{"line":1,"column":259}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":36,"column":4},"generated":{"line":1,"column":262}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":36,"column":9},"generated":{"line":1,"column":266}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":36,"column":27},"generated":{"line":1,"column":270}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":36,"column":41},"generated":{"line":1,"column":272}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":38,"column":6},"generated":{"line":1,"column":284}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":38,"column":12},"generated":{"line":1,"column":290}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":38,"column":16},"generated":{"line":1,"column":294}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":38,"column":27},"generated":{"line":1,"column":305}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":41,"column":4},"generated":{"line":1,"column":374}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":41,"column":9},"generated":{"line":1,"column":378}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":41,"column":45},"generated":{"line":1,"column":381}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":41,"column":24},"generated":{"line":1,"column":385}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":41,"column":36},"generated":{"line":1,"column":387}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":43,"column":6},"generated":{"line":1,"column":392}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":43,"column":12},"generated":{"line":1,"column":398}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":43,"column":16},"generated":{"line":1,"column":402}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":43,"column":27},"generated":{"line":1,"column":413}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":46,"column":4},"generated":{"line":1,"column":473}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":46,"column":9},"generated":{"line":1,"column":478}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":46,"column":25},"generated":{"line":1,"column":492}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":47,"column":4},"generated":{"line":1,"column":494}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":47,"column":9},"generated":{"line":1,"column":499}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":47,"column":23},"generated":{"line":1,"column":511}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":48,"column":4},"generated":{"line":1,"column":513}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":48,"column":9},"generated":{"line":1,"column":518}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":48,"column":33},"generated":{"line":1,"column":540}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":48,"column":38},"generated":{"line":1,"column":545}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":48,"column":52},"generated":{"line":1,"column":559}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":48,"column":65},"generated":{"line":1,"column":571}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":48,"column":71},"generated":{"line":1,"column":577}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":48,"column":76},"generated":{"line":1,"column":582}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":49,"column":4},"generated":{"line":1,"column":585}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":49,"column":9},"generated":{"line":1,"column":590}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":49,"column":34},"generated":{"line":1,"column":613}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":49,"column":39},"generated":{"line":1,"column":618}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":49,"column":63},"generated":{"line":1,"column":642}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":49,"column":79},"generated":{"line":1,"column":644}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":50,"column":4},"generated":{"line":1,"column":663}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":50,"column":9},"generated":{"line":1,"column":668}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":50,"column":36},"generated":{"line":1,"column":693}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":50,"column":41},"generated":{"line":1,"column":698}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":54,"column":9},"generated":{"line":1,"column":724}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":57,"column":4},"generated":{"line":1,"column":751}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":57,"column":8},"generated":{"line":1,"column":754}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":57,"column":13},"generated":{"line":1,"column":759}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":57,"column":27},"generated":{"line":1,"column":773}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":57,"column":37},"generated":{"line":1,"column":783}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":57,"column":48},"generated":{"line":1,"column":792}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":57,"column":65},"generated":{"line":1,"column":794}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":57,"column":66},"generated":{"line":1,"column":812}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":58,"column":6},"generated":{"line":1,"column":826}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":58,"column":12},"generated":{"line":1,"column":832}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":58,"column":16},"generated":{"line":1,"column":836}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":59,"column":61},"generated":{"line":1,"column":895}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":59,"column":66},"generated":{"line":1,"column":900}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":59,"column":80},"generated":{"line":1,"column":914}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":59,"column":90},"generated":{"line":1,"column":924}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":63,"column":4},"generated":{"line":1,"column":936}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":65,"column":10},"generated":{"line":1,"column":942}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":63,"column":37},"generated":{"line":1,"column":951}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":63,"column":37},"generated":{"line":1,"column":953}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":63,"column":50},"generated":{"line":1,"column":955}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":63,"column":51},"generated":{"line":1,"column":970}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":63,"column":56},"generated":{"line":1,"column":975}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":66,"column":7},"generated":{"line":1,"column":991}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":66,"column":13},"generated":{"line":1,"column":997}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":66,"column":18},"generated":{"line":1,"column":1002}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":66,"column":39},"generated":{"line":1,"column":1023}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":67,"column":7},"generated":{"line":1,"column":1026}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":67,"column":13},"generated":{"line":1,"column":1032}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":67,"column":18},"generated":{"line":1,"column":1037}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":68,"column":7},"generated":{"line":1,"column":1056}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":68,"column":13},"generated":{"line":1,"column":1062}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":69,"column":10},"generated":{"line":1,"column":1065}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":69,"column":29},"generated":{"line":1,"column":1067}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":69,"column":42},"generated":{"line":1,"column":1069}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":75,"column":4},"generated":{"line":1,"column":1076}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":75,"column":8},"generated":{"line":1,"column":1079}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":75,"column":29},"generated":{"line":1,"column":1083}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":75,"column":34},"generated":{"line":1,"column":1088}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":75,"column":46},"generated":{"line":1,"column":1100}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":75,"column":75},"generated":{"line":1,"column":1106}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":75,"column":54},"generated":{"line":1,"column":1110}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":76,"column":6},"generated":{"line":1,"column":1112}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":76,"column":12},"generated":{"line":1,"column":1118}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":76,"column":16},"generated":{"line":1,"column":1122}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":76,"column":22},"generated":{"line":1,"column":1128}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":79,"column":4},"generated":{"line":1,"column":1204}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":79,"column":10},"generated":{"line":1,"column":1210}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":79,"column":62},"generated":{"line":1,"column":1212}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":79,"column":66},"generated":{"line":1,"column":1216}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":79,"column":72},"generated":{"line":1,"column":1222}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":80,"column":4},"generated":{"line":1,"column":1225}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":80,"column":8},"generated":{"line":1,"column":1229}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":80,"column":45},"generated":{"line":1,"column":1231}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":81,"column":8},"generated":{"line":1,"column":1233}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":81,"column":42},"generated":{"line":1,"column":1235}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":84,"column":4},"generated":{"line":1,"column":1237}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":84,"column":9},"generated":{"line":1,"column":1241}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":84,"column":13},"generated":{"line":1,"column":1245}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":84,"column":21},"generated":{"line":1,"column":1247}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":84,"column":24},"generated":{"line":1,"column":1249}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":84,"column":32},"generated":{"line":1,"column":1251}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":84,"column":50},"generated":{"line":1,"column":1253}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":84,"column":59},"generated":{"line":1,"column":1257}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":85,"column":6},"generated":{"line":1,"column":1258}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":85,"column":12},"generated":{"line":1,"column":1264}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":85,"column":26},"generated":{"line":1,"column":1266}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":85,"column":39},"generated":{"line":1,"column":1268}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":86,"column":12},"generated":{"line":1,"column":1271}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":86,"column":38},"generated":{"line":1,"column":1273}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":87,"column":6},"generated":{"line":1,"column":1276}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":87,"column":30},"generated":{"line":1,"column":1278}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":87,"column":40},"generated":{"line":1,"column":1286}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":87,"column":44},"generated":{"line":1,"column":1290}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":87,"column":55},"generated":{"line":1,"column":1292}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":89,"column":6},"generated":{"line":1,"column":1304}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":89,"column":12},"generated":{"line":1,"column":1310}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":89,"column":28},"generated":{"line":1,"column":1312}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":89,"column":40},"generated":{"line":1,"column":1314}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":89,"column":49},"generated":{"line":1,"column":1323}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":89,"column":65},"generated":{"line":1,"column":1325}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":90,"column":6},"generated":{"line":1,"column":1345}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":90,"column":10},"generated":{"line":1,"column":1349}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":90,"column":36},"generated":{"line":1,"column":1352}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":91,"column":10},"generated":{"line":1,"column":1354}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":91,"column":34},"generated":{"line":1,"column":1357}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":92,"column":10},"generated":{"line":1,"column":1359}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":92,"column":26},"generated":{"line":1,"column":1362}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":93,"column":10},"generated":{"line":1,"column":1364}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":93,"column":22},"generated":{"line":1,"column":1366}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":95,"column":6},"generated":{"line":1,"column":1368}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":95,"column":11},"generated":{"line":1,"column":1372}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":95,"column":17},"generated":{"line":1,"column":1378}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":95,"column":33},"generated":{"line":1,"column":1383}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":96,"column":8},"generated":{"line":1,"column":1385}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":96,"column":13},"generated":{"line":1,"column":1388}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":115,"column":8},"generated":{"line":1,"column":1390}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":115,"column":36},"generated":{"line":1,"column":1393}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":115,"column":12},"generated":{"line":1,"column":1398}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":115,"column":25},"generated":{"line":1,"column":1400}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":125,"column":8},"generated":{"line":1,"column":1407}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":125,"column":13},"generated":{"line":1,"column":1410}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":142,"column":15},"generated":{"line":1,"column":1412}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":142,"column":39},"generated":{"line":1,"column":1414}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":143,"column":12},"generated":{"line":1,"column":1427}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":143,"column":36},"generated":{"line":1,"column":1429}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":143,"column":49},"generated":{"line":1,"column":1440}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":146,"column":10},"generated":{"line":1,"column":1444}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":146,"column":34},"generated":{"line":1,"column":1446}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":146,"column":48},"generated":{"line":1,"column":1458}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":125,"column":36},"generated":{"line":1,"column":1464}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":126,"column":10},"generated":{"line":1,"column":1465}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":126,"column":63},"generated":{"line":1,"column":1469}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":126,"column":14},"generated":{"line":1,"column":1473}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":126,"column":27},"generated":{"line":1,"column":1475}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":126,"column":35},"generated":{"line":1,"column":1483}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":128,"column":12},"generated":{"line":1,"column":1486}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":128,"column":18},"generated":{"line":1,"column":1492}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":128,"column":22},"generated":{"line":1,"column":1496}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":129,"column":53},"generated":{"line":1,"column":1541}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":129,"column":101},"generated":{"line":1,"column":1578}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":134,"column":10},"generated":{"line":1,"column":1585}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":134,"column":16},"generated":{"line":1,"column":1591}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":134,"column":25},"generated":{"line":1,"column":1593}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":134,"column":38},"generated":{"line":1,"column":1595}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":134,"column":44},"generated":{"line":1,"column":1601}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":135,"column":10},"generated":{"line":1,"column":1604}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":135,"column":34},"generated":{"line":1,"column":1606}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":135,"column":42},"generated":{"line":1,"column":1614}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":135,"column":46},"generated":{"line":1,"column":1618}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":135,"column":53},"generated":{"line":1,"column":1620}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":135,"column":57},"generated":{"line":1,"column":1623}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":135,"column":64},"generated":{"line":1,"column":1625}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":136,"column":14},"generated":{"line":1,"column":1629}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":136,"column":21},"generated":{"line":1,"column":1631}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":136,"column":28},"generated":{"line":1,"column":1636}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":136,"column":43},"generated":{"line":1,"column":1638}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":136,"column":44},"generated":{"line":1,"column":1654}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":137,"column":12},"generated":{"line":1,"column":1672}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":137,"column":36},"generated":{"line":1,"column":1674}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":137,"column":48},"generated":{"line":1,"column":1684}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":137,"column":55},"generated":{"line":1,"column":1686}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":138,"column":12},"generated":{"line":1,"column":1689}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":138,"column":28},"generated":{"line":1,"column":1692}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":117,"column":15},"generated":{"line":1,"column":1700}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":118,"column":12},"generated":{"line":1,"column":1704}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":118,"column":36},"generated":{"line":1,"column":1707}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":104,"column":10},"generated":{"line":1,"column":1715}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":98,"column":14},"generated":{"line":1,"column":1718}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":98,"column":27},"generated":{"line":1,"column":1720}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":98,"column":38},"generated":{"line":1,"column":1731}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":98,"column":53},"generated":{"line":1,"column":1733}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":98,"column":54},"generated":{"line":1,"column":1749}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":99,"column":12},"generated":{"line":1,"column":1763}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":99,"column":24},"generated":{"line":1,"column":1765}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":99,"column":33},"generated":{"line":1,"column":1774}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":99,"column":46},"generated":{"line":1,"column":1776}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":99,"column":52},"generated":{"line":1,"column":1782}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":99,"column":75},"generated":{"line":1,"column":1785}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":104,"column":14},"generated":{"line":1,"column":1790}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":104,"column":27},"generated":{"line":1,"column":1792}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":104,"column":38},"generated":{"line":1,"column":1803}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":104,"column":54},"generated":{"line":1,"column":1805}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":104,"column":57},"generated":{"line":1,"column":1823}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":105,"column":12},"generated":{"line":1,"column":1824}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":105,"column":38},"generated":{"line":1,"column":1827}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":107,"column":12},"generated":{"line":1,"column":1829}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":107,"column":18},"generated":{"line":1,"column":1835}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":107,"column":27},"generated":{"line":1,"column":1837}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":107,"column":40},"generated":{"line":1,"column":1839}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":107,"column":46},"generated":{"line":1,"column":1845}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":108,"column":12},"generated":{"line":1,"column":1848}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":108,"column":36},"generated":{"line":1,"column":1850}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":108,"column":45},"generated":{"line":1,"column":1857}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":108,"column":54},"generated":{"line":1,"column":1866}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":108,"column":61},"generated":{"line":1,"column":1868}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":109,"column":12},"generated":{"line":1,"column":1872}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":109,"column":36},"generated":{"line":1,"column":1874}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":109,"column":52},"generated":{"line":1,"column":1888}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":109,"column":59},"generated":{"line":1,"column":1890}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":109,"column":65},"generated":{"line":1,"column":1896}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":109,"column":68},"generated":{"line":1,"column":1899}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":109,"column":73},"generated":{"line":1,"column":1904}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":155,"column":8},"generated":{"line":1,"column":1907}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":155,"column":22},"generated":{"line":1,"column":1911}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":156,"column":8},"generated":{"line":1,"column":1914}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":156,"column":15},"generated":{"line":1,"column":1921}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":156,"column":25},"generated":{"line":1,"column":1931}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":157,"column":8},"generated":{"line":1,"column":1935}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":157,"column":21},"generated":{"line":1,"column":1938}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":158,"column":8},"generated":{"line":1,"column":1941}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":158,"column":20},"generated":{"line":1,"column":1943}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":158,"column":25},"generated":{"line":1,"column":1948}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":158,"column":37},"generated":{"line":1,"column":1960}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":159,"column":48},"generated":{"line":1,"column":1971}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":159,"column":8},"generated":{"line":1,"column":1975}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":159,"column":33},"generated":{"line":1,"column":1977}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":161,"column":8},"generated":{"line":1,"column":1981}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":161,"column":32},"generated":{"line":1,"column":1983}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":161,"column":43},"generated":{"line":1,"column":1992}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":161,"column":48},"generated":{"line":1,"column":1997}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":161,"column":60},"generated":{"line":1,"column":2009}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":161,"column":64},"generated":{"line":1,"column":2013}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":162,"column":8},"generated":{"line":1,"column":2016}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":162,"column":33},"generated":{"line":1,"column":2018}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":162,"column":46},"generated":{"line":1,"column":2021}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":164,"column":8},"generated":{"line":1,"column":2024}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":164,"column":14},"generated":{"line":1,"column":2026}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":164,"column":15},"generated":{"line":1,"column":2033}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":165,"column":26},"generated":{"line":1,"column":2055}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":165,"column":102},"generated":{"line":1,"column":2127}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":169,"column":10},"generated":{"line":1,"column":2132}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":170,"column":8},"generated":{"line":1,"column":2134}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":172,"column":8},"generated":{"line":1,"column":2138}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":176,"column":4},"generated":{"line":1,"column":2142}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":176,"column":11},"generated":{"line":1,"column":2148}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":177,"column":6},"generated":{"line":1,"column":2149}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":177,"column":20},"generated":{"line":1,"column":2162}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":178,"column":6},"generated":{"line":1,"column":2164}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":178,"column":34},"generated":{"line":1,"column":2191}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":179,"column":6},"generated":{"line":1,"column":2193}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":179,"column":31},"generated":{"line":1,"column":2217}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":182,"column":1},"generated":{"line":1,"column":2221}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":182,"column":1},"generated":{"line":1,"column":2229}},{"source":"../../../src/BatchResponseParser.ts","name":null,"original":{"line":182,"column":1},"generated":{"line":1,"column":2249}}],"sources":{"../../../src/BatchResponseParser.ts":"// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\nimport { HttpHeaders } from \"@azure/core-http\";\n\nimport { ServiceSubmitBatchResponseModel } from \"./generatedModels\";\nimport {\n  HTTP_VERSION_1_1,\n  HTTP_LINE_ENDING,\n  HeaderConstants,\n  HTTPURLConnection,\n} from \"./utils/constants\";\nimport { getBodyAsText } from \"./BatchUtils\";\nimport { BatchSubRequest } from \"./BlobBatch\";\nimport { BatchSubResponse, ParsedBatchResponse } from \"./BatchResponse\";\nimport { logger } from \"./log\";\n\nconst HTTP_HEADER_DELIMITER = \": \";\nconst SPACE_DELIMITER = \" \";\nconst NOT_FOUND = -1;\n\n/**\n * Util class for parsing batch response.\n */\nexport class BatchResponseParser {\n  private readonly batchResponse: ServiceSubmitBatchResponseModel;\n  private readonly responseBatchBoundary: string;\n  private readonly perResponsePrefix: string;\n  private readonly batchResponseEnding: string;\n  private readonly subRequests: Map<number, BatchSubRequest>;\n\n  constructor(\n    batchResponse: ServiceSubmitBatchResponseModel,\n    subRequests: Map<number, BatchSubRequest>\n  ) {\n    if (!batchResponse || !batchResponse.contentType) {\n      // In special case(reported), server may return invalid content-type which could not be parsed.\n      throw new RangeError(\"batchResponse is malformed or doesn't contain valid content-type.\");\n    }\n\n    if (!subRequests || subRequests.size === 0) {\n      // This should be prevent during coding.\n      throw new RangeError(\"Invalid state: subRequests is not provided or size is 0.\");\n    }\n\n    this.batchResponse = batchResponse;\n    this.subRequests = subRequests;\n    this.responseBatchBoundary = this.batchResponse.contentType!.split(\"=\")[1];\n    this.perResponsePrefix = `--${this.responseBatchBoundary}${HTTP_LINE_ENDING}`;\n    this.batchResponseEnding = `--${this.responseBatchBoundary}--`;\n  }\n\n  // For example of response, please refer to https://docs.microsoft.com/en-us/rest/api/storageservices/blob-batch#response\n  public async parseBatchResponse(): Promise<ParsedBatchResponse> {\n    // When logic reach here, suppose batch request has already succeeded with 202, so we can further parse\n    // sub request's response.\n    if (this.batchResponse._response.status !== HTTPURLConnection.HTTP_ACCEPTED) {\n      throw new Error(\n        `Invalid state: batch request failed with status: '${this.batchResponse._response.status}'.`\n      );\n    }\n\n    const responseBodyAsText = await getBodyAsText(this.batchResponse);\n\n    const subResponses = responseBodyAsText\n      .split(this.batchResponseEnding)[0] // string after ending is useless\n      .split(this.perResponsePrefix)\n      .slice(1); // string before first response boundary is useless\n    const subResponseCount = subResponses.length;\n\n    // Defensive coding in case of potential error parsing.\n    // Note: subResponseCount == 1 is special case where sub request is invalid.\n    // We try to prevent such cases through early validation, e.g. validate sub request count >= 1.\n    // While in unexpected sub request invalid case, we allow sub response to be parsed and return to user.\n    if (subResponseCount !== this.subRequests.size && subResponseCount !== 1) {\n      throw new Error(\"Invalid state: sub responses' count is not equal to sub requests' count.\");\n    }\n\n    const deserializedSubResponses: Array<BatchSubResponse> = new Array(subResponseCount);\n    let subResponsesSucceededCount: number = 0;\n    let subResponsesFailedCount: number = 0;\n\n    // Parse sub subResponses.\n    for (let index = 0; index < subResponseCount; index++) {\n      const subResponse = subResponses[index];\n      const deserializedSubResponse = {} as BatchSubResponse;\n      deserializedSubResponse.headers = new HttpHeaders();\n\n      const responseLines = subResponse.split(`${HTTP_LINE_ENDING}`);\n      let subRespHeaderStartFound = false;\n      let subRespHeaderEndFound = false;\n      let subRespFailed = false;\n      let contentId = NOT_FOUND;\n\n      for (const responseLine of responseLines) {\n        if (!subRespHeaderStartFound) {\n          // Convention line to indicate content ID\n          if (responseLine.startsWith(HeaderConstants.CONTENT_ID)) {\n            contentId = parseInt(responseLine.split(HTTP_HEADER_DELIMITER)[1]);\n          }\n\n          // Http version line with status code indicates the start of sub request's response.\n          // Example: HTTP/1.1 202 Accepted\n          if (responseLine.startsWith(HTTP_VERSION_1_1)) {\n            subRespHeaderStartFound = true;\n\n            const tokens = responseLine.split(SPACE_DELIMITER);\n            deserializedSubResponse.status = parseInt(tokens[1]);\n            deserializedSubResponse.statusMessage = tokens.slice(2).join(SPACE_DELIMITER);\n          }\n\n          continue; // Skip convention headers not specifically for sub request i.e. Content-Type: application/http and Content-ID: *\n        }\n\n        if (responseLine.trim() === \"\") {\n          // Sub response's header start line already found, and the first empty line indicates header end line found.\n          if (!subRespHeaderEndFound) {\n            subRespHeaderEndFound = true;\n          }\n\n          continue; // Skip empty line\n        }\n\n        // Note: when code reach here, it indicates subRespHeaderStartFound == true\n        if (!subRespHeaderEndFound) {\n          if (responseLine.indexOf(HTTP_HEADER_DELIMITER) === -1) {\n            // Defensive coding to prevent from missing valuable lines.\n            throw new Error(\n              `Invalid state: find non-empty line '${responseLine}' without HTTP header delimiter '${HTTP_HEADER_DELIMITER}'.`\n            );\n          }\n\n          // Parse headers of sub response.\n          const tokens = responseLine.split(HTTP_HEADER_DELIMITER);\n          deserializedSubResponse.headers.set(tokens[0], tokens[1]);\n          if (tokens[0] === HeaderConstants.X_MS_ERROR_CODE) {\n            deserializedSubResponse.errorCode = tokens[1];\n            subRespFailed = true;\n          }\n        } else {\n          // Assemble body of sub response.\n          if (!deserializedSubResponse.bodyAsText) {\n            deserializedSubResponse.bodyAsText = \"\";\n          }\n\n          deserializedSubResponse.bodyAsText += responseLine;\n        }\n      } // Inner for end\n\n      // The response will contain the Content-ID header for each corresponding subrequest response to use for tracking.\n      // The Content-IDs are set to a valid index in the subrequests we sent. In the status code 202 path, we could expect it\n      // to be 1-1 mapping from the [0, subRequests.size) to the Content-IDs returned. If not, we simply don't return that\n      // unexpected subResponse in the parsed reponse and we can always look it up in the raw response for debugging purpose.\n      if (\n        contentId !== NOT_FOUND &&\n        Number.isInteger(contentId) &&\n        contentId >= 0 &&\n        contentId < this.subRequests.size &&\n        deserializedSubResponses[contentId] === undefined\n      ) {\n        deserializedSubResponse._request = this.subRequests.get(contentId)!;\n        deserializedSubResponses[contentId] = deserializedSubResponse;\n      } else {\n        logger.error(\n          `subResponses[${index}] is dropped as the Content-ID is not found or invalid, Content-ID: ${contentId}`\n        );\n      }\n\n      if (subRespFailed) {\n        subResponsesFailedCount++;\n      } else {\n        subResponsesSucceededCount++;\n      }\n    }\n\n    return {\n      subResponses: deserializedSubResponses,\n      subResponsesSucceededCount: subResponsesSucceededCount,\n      subResponsesFailedCount: subResponsesFailedCount,\n    };\n  }\n}\n"},"lineCount":null}},"error":null,"hash":"b78418bbf72cc38be0b61d1dd3fdee4a","cacheData":{"env":{}}}