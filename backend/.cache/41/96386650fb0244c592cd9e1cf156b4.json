{"id":"PXKE","dependencies":[{"name":"C:\\Users\\ACC\\Desktop\\APH\\Acitizen-Pasco-Hub\\backend\\node_modules\\@azure\\storage-blob\\dist-esm\\storage-blob\\src\\utils\\Batch.js.map","includedInParent":true,"mtime":1672192592402},{"name":"C:\\Users\\ACC\\Desktop\\APH\\Acitizen-Pasco-Hub\\backend\\package.json","includedInParent":true,"mtime":1672218648515},{"name":"C:\\Users\\ACC\\Desktop\\APH\\Acitizen-Pasco-Hub\\backend\\node_modules\\@azure\\storage-blob\\package.json","includedInParent":true,"mtime":1672192591436},{"name":"events","loc":{"line":5,"column":29,"index":235},"parent":"C:\\Users\\ACC\\Desktop\\APH\\Acitizen-Pasco-Hub\\backend\\node_modules\\@azure\\storage-blob\\dist-esm\\storage-blob\\src\\utils\\Batch.js","resolved":"C:\\Users\\ACC\\AppData\\Roaming\\npm\\node_modules\\parcel-bundler\\node_modules\\events\\events.js"}],"generated":{"js":"\"use strict\";Object.defineProperty(exports,\"__esModule\",{value:!0}),exports.Batch=void 0;var t,e=require(\"events\");!function(t){t[t.Good=0]=\"Good\",t[t.Error=1]=\"Error\"}(t||(t={}));class r{constructor(r=5){if(this.actives=0,this.completed=0,this.offset=0,this.operations=[],this.state=t.Good,r<1)throw new RangeError(\"concurrency must be larger than 0\");this.concurrency=r,this.emitter=new e.EventEmitter}addOperation(t){this.operations.push(async()=>{try{this.actives++,await t(),this.actives--,this.completed++,this.parallelExecute()}catch(e){this.emitter.emit(\"error\",e)}})}async do(){return 0===this.operations.length?Promise.resolve():(this.parallelExecute(),new Promise((e,r)=>{this.emitter.on(\"finish\",e),this.emitter.on(\"error\",e=>{this.state=t.Error,r(e)})}))}nextOperation(){return this.offset<this.operations.length?this.operations[this.offset++]:null}parallelExecute(){if(this.state!==t.Error)if(this.completed>=this.operations.length)this.emitter.emit(\"finish\");else for(;this.actives<this.concurrency;){const t=this.nextOperation();if(!t)return;t()}}}exports.Batch=r;"},"sourceMaps":{"js":{"mappings":[{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":150,"column":1},"generated":{"line":1,"column":0}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":150,"column":1},"generated":{"line":1,"column":13}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":150,"column":1},"generated":{"line":1,"column":20}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":150,"column":1},"generated":{"line":1,"column":35}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":150,"column":1},"generated":{"line":1,"column":43}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":150,"column":1},"generated":{"line":1,"column":56}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":150,"column":1},"generated":{"line":1,"column":57}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":150,"column":1},"generated":{"line":1,"column":64}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":150,"column":1},"generated":{"line":1,"column":68}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":150,"column":1},"generated":{"line":1,"column":76}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":150,"column":1},"generated":{"line":1,"column":87}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":6,"column":0},"generated":{"line":1,"column":89}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":16,"column":5},"generated":{"line":1,"column":93}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":6,"column":0},"generated":{"line":1,"column":95}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":6,"column":0},"generated":{"line":1,"column":97}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":6,"column":0},"generated":{"line":1,"column":105}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":16,"column":0},"generated":{"line":1,"column":116}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":16,"column":5},"generated":{"line":1,"column":125}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":17,"column":2},"generated":{"line":1,"column":128}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":17,"column":2},"generated":{"line":1,"column":130}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":17,"column":2},"generated":{"line":1,"column":132}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":17,"column":2},"generated":{"line":1,"column":137}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":17,"column":2},"generated":{"line":1,"column":140}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":18,"column":2},"generated":{"line":1,"column":147}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":18,"column":2},"generated":{"line":1,"column":149}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":18,"column":2},"generated":{"line":1,"column":151}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":18,"column":2},"generated":{"line":1,"column":157}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":18,"column":2},"generated":{"line":1,"column":160}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":16,"column":0},"generated":{"line":1,"column":168}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":16,"column":5},"generated":{"line":1,"column":169}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":16,"column":5},"generated":{"line":1,"column":173}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":16,"column":16},"generated":{"line":1,"column":175}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":26,"column":6},"generated":{"line":1,"column":180}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":26,"column":13},"generated":{"line":1,"column":186}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":67,"column":2},"generated":{"line":1,"column":188}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":67,"column":21},"generated":{"line":1,"column":200}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":67,"column":43},"generated":{"line":1,"column":202}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":68,"column":4},"generated":{"line":1,"column":205}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":35,"column":10},"generated":{"line":1,"column":208}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":35,"column":10},"generated":{"line":1,"column":213}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":35,"column":28},"generated":{"line":1,"column":221}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":40,"column":10},"generated":{"line":1,"column":223}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":40,"column":10},"generated":{"line":1,"column":228}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":40,"column":30},"generated":{"line":1,"column":238}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":45,"column":10},"generated":{"line":1,"column":240}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":45,"column":10},"generated":{"line":1,"column":245}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":45,"column":27},"generated":{"line":1,"column":252}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":50,"column":10},"generated":{"line":1,"column":254}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":50,"column":10},"generated":{"line":1,"column":259}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":50,"column":36},"generated":{"line":1,"column":270}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":56,"column":10},"generated":{"line":1,"column":273}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":56,"column":10},"generated":{"line":1,"column":278}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":56,"column":31},"generated":{"line":1,"column":284}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":56,"column":43},"generated":{"line":1,"column":286}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":68,"column":8},"generated":{"line":1,"column":291}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":68,"column":22},"generated":{"line":1,"column":293}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":69,"column":6},"generated":{"line":1,"column":295}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":69,"column":12},"generated":{"line":1,"column":301}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":69,"column":16},"generated":{"line":1,"column":305}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":69,"column":27},"generated":{"line":1,"column":316}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":71,"column":4},"generated":{"line":1,"column":353}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":71,"column":9},"generated":{"line":1,"column":358}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":71,"column":23},"generated":{"line":1,"column":370}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":72,"column":4},"generated":{"line":1,"column":372}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":72,"column":9},"generated":{"line":1,"column":377}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":72,"column":19},"generated":{"line":1,"column":385}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":72,"column":23},"generated":{"line":1,"column":389}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":72,"column":35},"generated":{"line":1,"column":391}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":80,"column":9},"generated":{"line":1,"column":404}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":80,"column":22},"generated":{"line":1,"column":417}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":81,"column":4},"generated":{"line":1,"column":420}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":81,"column":9},"generated":{"line":1,"column":425}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":81,"column":20},"generated":{"line":1,"column":436}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":81,"column":25},"generated":{"line":1,"column":441}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":82,"column":6},"generated":{"line":1,"column":451}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":83,"column":8},"generated":{"line":1,"column":455}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":83,"column":13},"generated":{"line":1,"column":460}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":84,"column":14},"generated":{"line":1,"column":476}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":85,"column":8},"generated":{"line":1,"column":480}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":85,"column":13},"generated":{"line":1,"column":485}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":86,"column":8},"generated":{"line":1,"column":495}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":86,"column":13},"generated":{"line":1,"column":500}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":87,"column":8},"generated":{"line":1,"column":512}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":87,"column":13},"generated":{"line":1,"column":517}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":88,"column":8},"generated":{"line":1,"column":535}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":88,"column":15},"generated":{"line":1,"column":541}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":89,"column":8},"generated":{"line":1,"column":544}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":89,"column":13},"generated":{"line":1,"column":549}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":89,"column":21},"generated":{"line":1,"column":557}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":89,"column":26},"generated":{"line":1,"column":562}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":89,"column":35},"generated":{"line":1,"column":570}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":98,"column":9},"generated":{"line":1,"column":576}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":99,"column":4},"generated":{"line":1,"column":587}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":99,"column":35},"generated":{"line":1,"column":594}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":99,"column":8},"generated":{"line":1,"column":598}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":99,"column":13},"generated":{"line":1,"column":603}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":99,"column":24},"generated":{"line":1,"column":614}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":100,"column":13},"generated":{"line":1,"column":621}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":100,"column":21},"generated":{"line":1,"column":629}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":103,"column":4},"generated":{"line":1,"column":640}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":103,"column":9},"generated":{"line":1,"column":645}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":105,"column":11},"generated":{"line":1,"column":663}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":105,"column":15},"generated":{"line":1,"column":667}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":105,"column":29},"generated":{"line":1,"column":675}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":105,"column":30},"generated":{"line":1,"column":676}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":105,"column":39},"generated":{"line":1,"column":678}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":106,"column":6},"generated":{"line":1,"column":683}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":106,"column":11},"generated":{"line":1,"column":688}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":106,"column":19},"generated":{"line":1,"column":696}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":106,"column":22},"generated":{"line":1,"column":699}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":106,"column":32},"generated":{"line":1,"column":708}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":108,"column":6},"generated":{"line":1,"column":711}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":108,"column":11},"generated":{"line":1,"column":716}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":108,"column":19},"generated":{"line":1,"column":724}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":108,"column":22},"generated":{"line":1,"column":727}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":108,"column":32},"generated":{"line":1,"column":735}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":109,"column":8},"generated":{"line":1,"column":739}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":109,"column":13},"generated":{"line":1,"column":744}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":109,"column":21},"generated":{"line":1,"column":750}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":109,"column":33},"generated":{"line":1,"column":752}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":110,"column":8},"generated":{"line":1,"column":758}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":110,"column":15},"generated":{"line":1,"column":760}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":119,"column":10},"generated":{"line":1,"column":768}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":120,"column":4},"generated":{"line":1,"column":784}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":120,"column":8},"generated":{"line":1,"column":791}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":120,"column":13},"generated":{"line":1,"column":796}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":120,"column":22},"generated":{"line":1,"column":803}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":120,"column":27},"generated":{"line":1,"column":808}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":120,"column":38},"generated":{"line":1,"column":819}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":121,"column":13},"generated":{"line":1,"column":826}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":121,"column":18},"generated":{"line":1,"column":831}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":121,"column":29},"generated":{"line":1,"column":842}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":121,"column":34},"generated":{"line":1,"column":847}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":123,"column":11},"generated":{"line":1,"column":857}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":131,"column":10},"generated":{"line":1,"column":862}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":132,"column":4},"generated":{"line":1,"column":880}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":132,"column":8},"generated":{"line":1,"column":883}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":132,"column":13},"generated":{"line":1,"column":888}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":132,"column":23},"generated":{"line":1,"column":896}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":132,"column":35},"generated":{"line":1,"column":898}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":136,"column":4},"generated":{"line":1,"column":904}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":136,"column":8},"generated":{"line":1,"column":907}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":136,"column":13},"generated":{"line":1,"column":912}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":136,"column":26},"generated":{"line":1,"column":923}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":136,"column":31},"generated":{"line":1,"column":928}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":136,"column":42},"generated":{"line":1,"column":939}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":137,"column":6},"generated":{"line":1,"column":946}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":137,"column":11},"generated":{"line":1,"column":951}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":137,"column":19},"generated":{"line":1,"column":959}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":137,"column":24},"generated":{"line":1,"column":964}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":141,"column":4},"generated":{"line":1,"column":979}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":141,"column":11},"generated":{"line":1,"column":984}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":141,"column":16},"generated":{"line":1,"column":989}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":141,"column":26},"generated":{"line":1,"column":997}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":141,"column":31},"generated":{"line":1,"column":1002}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":141,"column":44},"generated":{"line":1,"column":1015}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":142,"column":6},"generated":{"line":1,"column":1016}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":142,"column":12},"generated":{"line":1,"column":1022}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":142,"column":24},"generated":{"line":1,"column":1024}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":142,"column":29},"generated":{"line":1,"column":1029}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":143,"column":6},"generated":{"line":1,"column":1045}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":143,"column":10},"generated":{"line":1,"column":1049}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":146,"column":8},"generated":{"line":1,"column":1051}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":144,"column":8},"generated":{"line":1,"column":1058}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":150,"column":1},"generated":{"line":1,"column":1064}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":150,"column":1},"generated":{"line":1,"column":1072}},{"source":"../../../../src/utils/Batch.ts","name":null,"original":{"line":150,"column":1},"generated":{"line":1,"column":1078}}],"sources":{"../../../../src/utils/Batch.ts":"// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\n// In browser, during webpack or browserify bundling, this module will be replaced by 'events'\n// https://github.com/Gozala/events\nimport { EventEmitter } from \"events\";\n\n/**\n * Operation is an async function to be executed and managed by Batch.\n */\nexport declare type Operation = () => Promise<any>;\n\n/**\n * States for Batch.\n */\nenum BatchStates {\n  Good,\n  Error,\n}\n\n/**\n * Batch provides basic parallel execution with concurrency limits.\n * Will stop execute left operations when one of the executed operation throws an error.\n * But Batch cannot cancel ongoing operations, you need to cancel them by yourself.\n */\nexport class Batch {\n  /**\n   * Concurrency. Must be lager than 0.\n   */\n  private concurrency: number;\n\n  /**\n   * Number of active operations under execution.\n   */\n  private actives: number = 0;\n\n  /**\n   * Number of completed operations under execution.\n   */\n  private completed: number = 0;\n\n  /**\n   * Offset of next operation to be executed.\n   */\n  private offset: number = 0;\n\n  /**\n   * Operation array to be executed.\n   */\n  private operations: Operation[] = [];\n\n  /**\n   * States of Batch. When an error happens, state will turn into error.\n   * Batch will stop execute left operations.\n   */\n  private state: BatchStates = BatchStates.Good;\n\n  /**\n   * A private emitter used to pass events inside this class.\n   */\n  private emitter: EventEmitter;\n\n  /**\n   * Creates an instance of Batch.\n   * @param concurrency -\n   */\n  public constructor(concurrency: number = 5) {\n    if (concurrency < 1) {\n      throw new RangeError(\"concurrency must be larger than 0\");\n    }\n    this.concurrency = concurrency;\n    this.emitter = new EventEmitter();\n  }\n\n  /**\n   * Add a operation into queue.\n   *\n   * @param operation -\n   */\n  public addOperation(operation: Operation): void {\n    this.operations.push(async () => {\n      try {\n        this.actives++;\n        await operation();\n        this.actives--;\n        this.completed++;\n        this.parallelExecute();\n      } catch (error: any) {\n        this.emitter.emit(\"error\", error);\n      }\n    });\n  }\n\n  /**\n   * Start execute operations in the queue.\n   *\n   */\n  public async do(): Promise<void> {\n    if (this.operations.length === 0) {\n      return Promise.resolve();\n    }\n\n    this.parallelExecute();\n\n    return new Promise<void>((resolve, reject) => {\n      this.emitter.on(\"finish\", resolve);\n\n      this.emitter.on(\"error\", (error) => {\n        this.state = BatchStates.Error;\n        reject(error);\n      });\n    });\n  }\n\n  /**\n   * Get next operation to be executed. Return null when reaching ends.\n   *\n   */\n  private nextOperation(): Operation | null {\n    if (this.offset < this.operations.length) {\n      return this.operations[this.offset++];\n    }\n    return null;\n  }\n\n  /**\n   * Start execute operations. One one the most important difference between\n   * this method with do() is that do() wraps as an sync method.\n   *\n   */\n  private parallelExecute(): void {\n    if (this.state === BatchStates.Error) {\n      return;\n    }\n\n    if (this.completed >= this.operations.length) {\n      this.emitter.emit(\"finish\");\n      return;\n    }\n\n    while (this.actives < this.concurrency) {\n      const operation = this.nextOperation();\n      if (operation) {\n        operation();\n      } else {\n        return;\n      }\n    }\n  }\n}\n"},"lineCount":null}},"error":null,"hash":"f40eac1d9b8ef9be7f1f1266a2add143","cacheData":{"env":{}}}